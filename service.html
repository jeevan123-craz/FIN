<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ’¼ Personal Finance Dashboard</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
    }
    header {
      background: #343a40;
      color: #fff;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    .service-btn {
      position: absolute;
      right: 20px;
      top: 20px;
      padding: 8px 14px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }
    .service-btn:hover { background: #218838; }
    .container {
      display: flex;
      gap: 20px;
      padding: 20px;
      flex-wrap: wrap;
    }
    .card {
      flex: 1;
      min-width: 350px;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h2 {
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 500;
    }
    input {
      padding: 8px;
      width: 100%;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      margin-top: 15px;
      padding: 10px 15px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    #result, #fuelResult {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #f1f3f5;
    }
    #expenseChart {
      max-width: 400px;
      max-height: 250px;
      margin-top: 20px;
    }
    .loan-list {
      margin-top: 20px;
    }
    .loan-item {
      padding: 10px;
      background: #f8f9fa;
      border-left: 4px solid #007bff;
      margin-bottom: 10px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .expense-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
    }
    .expense-row input { flex: 1; }
    .delete-btn {
      background: #dc3545;
      padding: 5px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-left: 10px;
    }
    .delete-btn:hover { background: #c82333; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ’¼ Personal Finance Dashboard</h1>
    <button class="service-btn" onclick="location.href='service.html'">ðŸ”— Services</button>
  </header>

  <div class="container">
    <!-- Expense Tracker + Fuel -->
    <div class="card">
      <h2>ðŸ’° Monthly Expense Calculator</h2>
      <label>Monthly Salary:</label>
      <input type="number" id="salary" placeholder="â‚¹">

      <h3>Expenses</h3>
      <div id="expenseList"></div>
      <div class="expense-row">
        <input type="text" id="newCategory" placeholder="New category (e.g. Fuel)">
        <button onclick="addCategory()">âž• Add</button>
      </div>
      <button onclick="calculate()">Calculate Balance</button>
      <button onclick="deleteAllExpenses()" style="background:#dc3545;">ðŸ—‘ Delete All Expenses</button>
      <div id="result"></div>
      <canvas id="expenseChart"></canvas>

      <!-- Fuel Calculator -->
      <h3>â›½ Fuel Cost Calculator</h3>
      <label>Starting Point:</label>
      <input type="text" id="startPoint" placeholder="Enter starting address">
      <label>Destination Point:</label>
      <input type="text" id="endPoint" placeholder="Enter destination address">
      <label>Vehicle Mileage (km/l):</label>
      <input type="number" id="mileage" placeholder="e.g., 15">
      <label>Fuel Price (â‚¹/liter):</label>
      <input type="number" id="fuelPrice" placeholder="e.g., 110">
      <button onclick="calculateFuelCost()">Calculate Fuel Cost</button>
      <p id="fuelResult"></p>
    </div>

    <!-- Loan EMI Section -->
    <div class="card">
      <h2>ðŸ“… Loan EMI Scheduler</h2>
      <label>Loan Name:</label>
      <input type="text" id="loanName">
      <label>Monthly EMI Amount:</label>
      <input type="number" id="loanAmount" placeholder="â‚¹">
      <label>Due Date:</label>
      <input type="date" id="loanDate">
      <label>Email for Reminder:</label>
      <input type="email" id="userEmail" placeholder="you@example.com">

      <button onclick="addLoan()">Add Loan EMI</button>
      <button onclick="deleteAllLoans()" style="background:#dc3545;">ðŸ—‘ Delete All EMI</button>
      <div class="loan-list" id="loanList"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let expenseChart;
    let loans = JSON.parse(localStorage.getItem("loans")) || [];
    let categories = JSON.parse(localStorage.getItem("categories")) || [
      { name: "Groceries", value: 0 },
      { name: "Medical", value: 0 },
      { name: "Shopping", value: 0 }
    ];

    window.onload = function() {
      document.getElementById("salary").value = localStorage.getItem("salary") || "";
      renderCategories();
      renderLoans();
    };

    function renderCategories() {
      const container = document.getElementById("expenseList");
      container.innerHTML = "";
      categories.forEach((cat,index)=>{
        container.innerHTML += `<div class="expense-row">
          <label>${cat.name}:</label>
          <input type="number" value="${cat.value}" onchange="updateCategory(${index}, this.value)">
        </div>`;
      });
    }

    function updateCategory(index,value) {
      categories[index].value = parseFloat(value)||0;
      localStorage.setItem("categories",JSON.stringify(categories));
    }

    function addCategory() {
      const name=document.getElementById("newCategory").value.trim();
      if(!name) return alert("Please enter a category name.");
      categories.push({name,value:0});
      document.getElementById("newCategory").value="";
      localStorage.setItem("categories",JSON.stringify(categories));
      renderCategories();
    }

    function calculate() {
      const salary=parseFloat(document.getElementById("salary").value)||0;
      localStorage.setItem("salary",salary);
      let totalExpenses = categories.reduce((sum,cat)=>sum+(cat.value||0),0);
      const balance = salary - totalExpenses;

      document.getElementById("result").innerHTML = `
        <h3>ðŸ“Š Expense Summary</h3>
        <p><strong>Total Monthly Expenses:</strong> â‚¹${totalExpenses.toFixed(2)}</p>
        <p><strong>Remaining Balance:</strong> â‚¹${balance.toFixed(2)}</p>
      `;

      const ctx=document.getElementById("expenseChart").getContext("2d");
      if(expenseChart) expenseChart.destroy();
      expenseChart=new Chart(ctx,{
        type:"pie",
        data:{
          labels:categories.map(c=>c.name),
          datasets:[{data:categories.map(c=>c.value),
            backgroundColor:['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#66BB6A','#D32F2F','#0288D1']
          }]
        },
        options:{responsive:true,plugins:{legend:{position:"bottom"}}}
      });
    }

    // Loan Section
    function addLoan() {
      const name=document.getElementById('loanName').value;
      const amount=document.getElementById('loanAmount').value;
      const date=document.getElementById('loanDate').value;
      const email=document.getElementById('userEmail').value;
      if(!name||!amount||!date||!email){ alert("Please fill all loan fields!"); return; }
      loans.push({name,amount,date,email});
      localStorage.setItem("loans", JSON.stringify(loans));
      renderLoans();
    }

    function deleteLoan(index) {
      loans.splice(index,1);
      localStorage.setItem("loans", JSON.stringify(loans));
      renderLoans();
    }

    function deleteAllLoans() {
      if(confirm("Are you sure you want to delete all EMIs?")) {
        loans = [];
        localStorage.removeItem("loans");
        renderLoans();
      }
    }

    function deleteAllExpenses() {
      if(confirm("Are you sure you want to delete all expenses?")) {
        categories = [
          { name: "Groceries", value: 0 },
          { name: "Medical", value: 0 },
          { name: "Shopping", value: 0 }
        ];
        localStorage.removeItem("categories");
        document.getElementById("salary").value = "";
        localStorage.removeItem("salary");
        renderCategories();
        document.getElementById("result").innerHTML = "";
        if(expenseChart) expenseChart.destroy();
      }
    }

    // Fuel Calculator
    async function calculateFuelCost() {
      const start=document.getElementById("startPoint").value;
      const end=document.getElementById("endPoint").value;
      const mileage=parseFloat(document.getElementById("mileage").value);
      const fuelPrice=parseFloat(document.getElementById("fuelPrice").value);
      if(!start||!end||!mileage||!fuelPrice){return alert("Please fill all fields!");}

      const apiKey="YOUR_GOOGLE_API_KEY"; // Replace with your Google Maps API key
      const url=`https://maps.googleapis.com/maps/api/distancematrix/json?origins=${encodeURIComponent(start)}&destinations=${encodeURIComponent(end)}&key=${apiKey}&units=metric`;

      try{
        const response = await fetch(`https://cors-anywhere.herokuapp.com/${url}`);
        const data = await response.json();
        if(data.status!=="OK"){ return alert("Error fetching distance: "+data.status); }

        const distanceKm = data.rows[0].elements[0].distance.value / 1000;
        const fuelNeeded = distanceKm/mileage;
        const fuelCost = fuelNeeded*fuelPrice;

        document.getElementById("fuelResult").innerHTML = `
          Distance: ${distanceKm.toFixed(2)} km<br>
          Fuel Needed: ${fuelNeeded.toFixed(2)} liters<br>
          Estimated Fuel Cost: â‚¹${fuelCost.toFixed(2)}
        `;
      } catch(err){console.error(err); alert("Failed to fetch distance. Check console."); }
    }

    function renderLoans() {
      const loanList=document.getElementById('loanList'); 
      loanList.innerHTML="";
      loans.forEach((l,i)=>{
        loanList.innerHTML+=`<div class="loan-item">
          <div>
            <strong>${l.name}</strong><br>EMI: â‚¹${l.amount}<br>Due: ${l.date}<br>Email: ${l.email}
          </div>
          <button class="delete-btn" onclick="deleteLoan(${i})">Delete</button>
        </div>`;
      });
    }
  </script>
</body>
</html>
